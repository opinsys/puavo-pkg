#!/bin/sh

set -eu

installdir=$1

mkdir -p /opt/spotify
ln -sf -T "${installdir}/opt/spotify/spotify-client" /opt/spotify/spotify-client

mkdir -p /usr/bin
ln -sf -T /opt/spotify/spotify-client/spotify /usr/bin/spotify

for icon in /opt/spotify/spotify-client/Icons/spotify-linux-*.png; do
  icon_size="${icon##*/spotify-linux-}"
  xdg-icon-resource install --size "${icon_size%.png}" "${icon}" spotify-client
done

# It seems the desktop file has to match the mpris name.
# I don't want to change that, so we use --novendor here
xdg-desktop-menu install --novendor /opt/spotify/spotify-client/spotify.desktop
