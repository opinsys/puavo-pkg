#!/bin/sh

set -eu

command=$1
shift

case "${command}" in
    configure)
        upstream_dir=$1

        # Generate /run/primary_disk_id needed by TI-Nspire
        # and our patched wine.
        smartctl -i /dev/sda \
          | awk '
              $1 == "Serial" && $2 == "Number:" { printf "%s", $3; exit(0) }
            ' > /run/primary_disk_id.tmp
        mv /run/primary_disk_id.tmp /run/primary_disk_id
        mkdir -p /opt/TINspireCXCASStudentSoftware
        ln -fns "${upstream_dir}/ti-inspire-cx-cas.msi" \
                /opt/TINspireCXCASStudentSoftware/ti-inspire-cx-cas.msi
        ;;

    unconfigure)
        rm -f /opt/TINspireCXCASStudentSoftware/ti-inspire-cx-cas.msi
        rmdir --ignore-fail-on-non-empty /opt/TINspireCXCASStudentSoftware
        ;;

    unpack)
        upstream_pack=$1
        upstream_dir=$2
        cp -p "$upstream_pack" "${upstream_dir}/ti-inspire-cx-cas.msi"
        ;;

    *)
        ;;
esac
